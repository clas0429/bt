<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å…¨èƒ½è®Šè²éŸ³ç®±</title>
    <style>
        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            text-align: center;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
        }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* é¸å–®æ¨™ç±¤ */
        label { display: block; text-align: left; margin: 10px 0 5px 5%; color: #bdc3c7; font-size: 14px;}

        /* ä¸‹æ‹‰é¸å–® */
        select {
            padding: 12px;
            font-size: 16px;
            border-radius: 10px;
            margin-bottom: 10px;
            width: 90%;
            border: none;
            background: #ecf0f1;
            color: #2c3e50;
        }

        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ•æ¨£å¼ (åŒå‰) */
        .input-group { position: relative; width: 90%; margin: 0 auto; }
        textarea {
            width: 100%; height: 100px; padding: 15px; font-size: 18px;
            border-radius: 15px; border: none; resize: none; box-sizing: border-box;
        }
        .mic-btn {
            position: absolute; bottom: 10px; right: 10px;
            background-color: #3498db; border: none; border-radius: 50%;
            width: 50px; height: 50px; font-size: 24px; cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .mic-btn.listening { background-color: #e74c3c; animation: pulse 1.5s infinite; }
        .btn-ask {
            width: 90%; padding: 15px; font-size: 20px; border: none;
            border-radius: 50px; cursor: pointer; margin-top: 20px;
            background-color: #27ae60; color: white; font-weight: bold;
            box-shadow: 0 4px 0 #219150;
        }
        .btn-ask:active { transform: translateY(4px); box-shadow: none; }
        #responseArea {
            margin-top: 20px; padding: 20px; background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px; text-align: left; min-height: 100px;
            line-height: 1.6; white-space: pre-wrap;
        }
        .status { color: #f1c40f; font-size: 14px; margin-top: 10px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ¤ AI å…¨èƒ½è®Šè²éŸ³ç®±</h1>
        
        <label>1. é¸æ“‡ AI çš„å€‹æ€§ (åŠ‡æœ¬)</label>
        <select id="aiTone">
            <option value="normal">ğŸ¤– æ­£å¸¸åŠ©ç†</option>
            <option value="kindergarten">ğŸ§¸ å¹¼å…’åœ’è€å¸«</option>
            <option value="humorous">ğŸ¤£ å¹½é»˜æç¬‘å’–</option>
            <option value="tsundere">ğŸ˜¤ å‚²å¬Œæ©Ÿå™¨äºº</option>
            <option value="gangster">ğŸ˜ æ±Ÿæ¹–å¤§å“¥</option>
        </select>

        <label>2. é¸æ“‡è²éŸ³ä¾†æº (æ±ºå®šç”·è²/å¥³è²)</label>
        <select id="voiceSelect">
            <option value="">æ­£åœ¨è®€å–æ‰‹æ©Ÿè£¡çš„è²éŸ³...</option>
        </select>

        <div class="input-group">
            <textarea id="userInput" placeholder="æŒ‰éº¥å…‹é¢¨èªªè©±ï¼Œæˆ–è¼¸å…¥æ–‡å­—..."></textarea>
            <button class="mic-btn" id="micBtn" onclick="toggleSpeech()">ğŸ¤</button>
        </div>
        
        <button class="btn-ask" onclick="askGemini()">ğŸš€ ç™¼é€çµ¦ AI</button>
        
        <div id="statusText" class="status"></div>
        <div id="responseArea">ç­‰å¾…å°è©±ä¸­...</div>
    </div>

    <script>
        // ğŸ”´ è«‹åœ¨é€™è£¡è²¼ä¸Šä½  æ–°çš„ API Key
        const API_KEY = "AIzaSyBR89k--Pp9VjXHSLDLuBkS3x41OS4lfPg"; 

        // --- 1. è²éŸ³è¼‰å…¥åŠŸèƒ½ (æœ€é‡è¦çš„éƒ¨åˆ†) ---
        let voices = [];
        const voiceSelect = document.getElementById("voiceSelect");

        function loadVoices() {
            // æŠ“å–ç€è¦½å™¨æä¾›çš„æ‰€æœ‰è²éŸ³
            voices = window.speechSynthesis.getVoices();
            
            // æ¸…ç©ºé¸å–®
            voiceSelect.innerHTML = "";

            // ç¯©é¸å‡ºä¸­æ–‡è²éŸ³ (zh-TW, zh-CN, zh-HK)
            // å¦‚æœä½ æƒ³è¦æ‰€æœ‰èªè¨€ï¼Œå¯ä»¥æŠŠ .filter é‚£è¡Œæ‹¿æ‰
            const chineseVoices = voices.filter(voice => voice.lang.includes('zh'));

            if (chineseVoices.length === 0) {
                // å¦‚æœæ‰¾ä¸åˆ°ä¸­æ–‡è²éŸ³ï¼Œå°±é¡¯ç¤ºå…¨éƒ¨è®“ä½¿ç”¨è€…æŒ‘
                voices.forEach(addOption);
            } else {
                chineseVoices.forEach(addOption);
            }

            // å¦‚æœçœŸçš„æ²’æŠ“åˆ°ä»»ä½•è²éŸ³ (æœ‰äº›æ‰‹æ©Ÿæ¯”è¼ƒæ…¢)
            if (voiceSelect.options.length === 0) {
                const option = document.createElement('option');
                option.textContent = "é è¨­è²éŸ³ (ç„¡æ³•é¸æ“‡)";
                voiceSelect.appendChild(option);
            }
        }

        function addOption(voice, index) {
            const option = document.createElement('option');
            option.textContent = `${voice.name} (${voice.lang})`; // é¡¯ç¤ºåå­—å’Œèªè¨€
            option.value = index; // æˆ‘å€‘ç”¨é™£åˆ—çš„ä½ç½®ä¾†è¨˜éŒ„
            voiceSelect.appendChild(option);
        }

        // ç›£è½ï¼šç•¶ç€è¦½å™¨æº–å‚™å¥½è²éŸ³æ™‚ï¼Œå°±åŸ·è¡Œè¼‰å…¥
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        // ä¸€é–‹å§‹å…ˆè©¦è‘—è·‘ä¸€æ¬¡
        loadVoices();


        // --- 2. èªéŸ³è¾¨è­˜ (åŒå‰) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isListening = false;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'zh-TW';
            recognition.interimResults = true;
            recognition.continuous = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById("userInput").value = transcript;
            };
            recognition.onend = function() {
                isListening = false;
                document.getElementById("micBtn").classList.remove("listening");
                document.getElementById("statusText").innerText = "ğŸ¤ éŒ„éŸ³çµæŸ";
            };
            recognition.onerror = function(event) {
                isListening = false;
                document.getElementById("micBtn").classList.remove("listening");
            };
        }

        function toggleSpeech() {
            if (!recognition) { alert("ä¸æ”¯æ´èªéŸ³è¼¸å…¥"); return; }
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
                isListening = true;
                document.getElementById("micBtn").classList.add("listening");
                document.getElementById("statusText").innerText = "ğŸ‘‚ æ­£åœ¨è½...";
                document.getElementById("userInput").value = "";
            }
        }

        // --- 3. AI å°è©± (askGemini) ---
        async function askGemini() {
            const inputText = document.getElementById("userInput").value;
            const tone = document.getElementById("aiTone").value;
            const statusDiv = document.getElementById("statusText");
            const responseDiv = document.getElementById("responseArea");

            if (!inputText) { alert("è«‹è¼¸å…¥æ–‡å­—"); return; }

            statusDiv.innerText = "ğŸ§  AI æ€è€ƒä¸­...";
            responseDiv.innerText = "Loading...";

            let toneInstruction = "";
            switch(tone) {
                case "kindergarten": toneInstruction = "è«‹æ‰®æ¼”æº«æŸ”çš„å¹¼å…’åœ’è€å¸«ï¼Œç”¨èªå¯æ„›ï¼Œä½¿ç”¨ç–Šå­—ã€‚"; break;
                case "humorous": toneInstruction = "è«‹æ‰®æ¼”å¹½é»˜çš„å–œåŠ‡æ¼”å“¡ï¼Œå›ç­”è¦æœ‰æ¢—å¥½ç¬‘ã€‚"; break;
                case "tsundere": toneInstruction = "è«‹æ‰®æ¼”å‚²å¬Œæ©Ÿå™¨äººï¼Œå£å«Œé«”æ­£ç›´ï¼Œå¸¸ç”¨'å“¼'ã€‚"; break;
                case "gangster": toneInstruction = "è«‹æ‰®æ¼”æ±Ÿæ¹–å¤§å“¥ï¼Œè¬›ç¾©æ°£ï¼Œç¨±å‘¼å°æ–¹å…„å¼Ÿã€‚"; break;
                default: toneInstruction = "è«‹ç”¨ç°¡çŸ­å£èªåŒ–çš„ç¹é«”ä¸­æ–‡å›ç­”ã€‚";
            }

            const prompt = `${toneInstruction} (ç´„50å­—å°è©±)ã€‚å•é¡Œï¼š${inputText}`;
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const result = await response.json();
                
                if (result.error || !result.candidates) {
                    throw new Error(result.error?.message || "ç„¡å›æ‡‰");
                }

                const aiText = result.candidates[0].content.parts[0].text;
                
                statusDiv.innerText = "âœ… æº–å‚™æ’­æ”¾";
                responseDiv.innerText = aiText;
                speakOut(aiText);

            } catch (error) {
                console.error(error);
                statusDiv.innerText = "âŒ éŒ¯èª¤";
                responseDiv.innerText = error;
            }
        }

        // --- 4. æ–‡å­—è½‰èªéŸ³ (æ›´æ–°ç‰ˆï¼šä½¿ç”¨é¸å®šçš„è²éŸ³) ---
        function speakOut(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            
            // ğŸ”´ é—œéµï¼šæŠŠä½¿ç”¨è€…é¸åˆ°çš„è²éŸ³å¥—ç”¨ä¸Šå»
            const selectedIndex = voiceSelect.value;
            // å¦‚æœé¸å–®è£¡æœ‰é¸æ±è¥¿ï¼Œè€Œä¸” voices é™£åˆ—ä¸æ˜¯ç©ºçš„
            if (selectedIndex !== "" && voices.length > 0) {
                // æ‰¾å‡ºæ˜¯å“ªä¸€å€‹è²éŸ³ç‰©ä»¶ (é€™æ˜¯ç€è¦½å™¨è¦å®šçš„å¯«æ³•)
                // é€™è£¡æˆ‘å€‘åœ¨ HTML value å­˜çš„æ˜¯ indexï¼Œä½†ç‚ºäº†ä¿éšªï¼Œæˆ‘å€‘ç”¨ filter çš„é‚è¼¯
                // ç°¡å–®åšæ³•ï¼šç›´æ¥å°æ‡‰å‰›å‰› voices é™£åˆ—
                const chineseVoices = voices.filter(voice => voice.lang.includes('zh'));
                
                // å¦‚æœæœ‰ç¯©é¸éä¸­æ–‡ï¼Œå°±å¾ä¸­æ–‡åˆ—è¡¨æ‹¿ï¼Œä¸ç„¶å¾ç¸½è¡¨æ‹¿
                if(chineseVoices.length > 0) {
                    utterance.voice = chineseVoices[selectedIndex];
                } else {
                    utterance.voice = voices[selectedIndex];
                }
            }

            utterance.rate = 1.0;
            
            // æ ¹æ“šæ€§æ ¼å¾®èª¿èªé€Ÿ
            const tone = document.getElementById("aiTone").value;
            if (tone === "kindergarten") utterance.rate = 0.8;
            if (tone === "humorous") utterance.rate = 1.1;

            window.speechSynthesis.speak(utterance);
        }
    </script>

</body>
</html>
